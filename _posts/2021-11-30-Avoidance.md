---
layout: single
title: "은행원 알고리즘 과 자원 할당 그래프 알고리즘"
---

저번 포스팅에 연결된 교착상태를 피하는 방법을 정리하려고 한다.

<br/>
<br/>

# 자원 할당 그래프

자원 할당 그래프 알고리즘을 알기 위해선 먼저 자원 할당 그래프에 대해서 알아야 한다.

프로세스가 자원을 요청하고 자원이 프로세스에게 할당 되는 방향성을 가진 그래프로 교착 상태 발생 여부를 탐지 할 수 있는 그래프이다.

<img src= "https://user-images.githubusercontent.com/58356031/143991274-b5014c22-0337-49eb-b98e-f913d064813b.png" width="400">

P는 프로세스, R은 자원을 나타낸다.



<br/>
<br/>

이번엔 교착상태가 일어난 그래프 예시를 보자.

<img src= "https://user-images.githubusercontent.com/58356031/143991282-37d9d90f-6919-41d4-96f8-cbf0b99d3e98.png" width="400">

P3은 R2에게 자원을 요청했고 R2는 P2에게 자원을 제공하고 있으며 P2는 R3에게 자원을 요청했고 R3는 P3에게 자원을 제공중이다.
결국 `P3->R2->P2->R3->P3` 같은 사이클이 돌고있다.

마찬가지로 R2에서 P1에게 제공하는 사이클로 돌게되면 `P3->R2->P1->R1->P2->R3->P3` 로 사이클이 만들어져 이상태를 교착 상태가 발생했다고 한다.

<br/>
<br/>

이번엔 사이클이 존재하지만 교착 상태가 아닌 그래프의 예시를 보자.

<img src= "https://user-images.githubusercontent.com/58356031/143991829-7b033979-35cf-49a0-a629-0a2be5a55c33.png" width="400">

이번에도 `P2->R2->P1->R1->P2` 사이클이 존재하지만 이건 교착상태가 아니다. P3 나 P4가 작업을 다 마치고 자원을 돌려주면 교착상태가 해제되기 때문이다.

<br/>
<br/>

### 정리
- 자원 할당 그래프로 교차 상태 발생 여부를 확인할 수 있다.
- 그래프에 cycle이 없으면 교차 상태가 아니다.
- 그래프에 cycle이 존재한다면
  - 다른 프로세스가 작업을 완료하고 자원을 반납했을 때 자원의 무한 대기가 풀리는 상태
  - 모든 프로세스가 서로의 자원을 요구하면서 무한정 대기하는 교차 상태


<br/>
<br/>

# 자원 할당 그래프 알고리즘

위 내용에서 클레임선이라는 것이 더 추가된다. 클레임선은 P(i) 프로세스가 미래에 R(j)를 요청할 수 도 있다는 의미이고 주로 점선 화살표로 표시한다.

Cycle 생성 여부 조사할때 프로세스가 n개일때 O(N^2) 시간이 걸린다고 한다.

<img src= "https://user-images.githubusercontent.com/58356031/143992937-ba6282fb-ef4d-4cdb-8b4d-c452371dcc24.png" width="400">

여기서 R1의 자원을 P2가 요청해서 할당받았다.

<br/>
<br/>


<img src= "https://user-images.githubusercontent.com/58356031/143993199-919bed53-519e-4f86-be3c-7e1b24fc51a0.png" width="400">

이때 P1이 R1에게 자원을 요청하려고 한다면 Cycle이 만들어지고 교차 상태가 발생하게 되기때문에 R1에 대한 요청을 받아주지 않으며 교차 상태 발생을 막는다.

<br/>
<br/>



# 은행원 알고리즘

교착상태에서 빠질 가능성을 안전상태와 불안전상태로 나누며 체크하고 안전상태를 유지할 수 있는 요구만 수락하고, 나머지 요구는 안전상태를 만족할 때 까지 계속 거절하는 방식이다.







<br/>
<br/>




### 정리 
자원당 instance 가 한개일때는 자원 할당 그래프 알고리즘을 사용하고 자원당 instance가 여러개 일때 은행원 알고리즘을 사용한다.
